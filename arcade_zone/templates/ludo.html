<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ludo Battle â€¢ Shanvika vs Shantanu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #0f172a; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; overflow: hidden; font-family: 'Segoe UI', sans-serif; touch-action: none;}
        .board-container { position: relative; width: 320px; height: 320px; background: white; border-radius: 10px; padding: 5px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        /* Using a precise grid mapping for the Ludo Track */
        .ludo-grid { display: grid; grid-template-columns: repeat(15, 1fr); grid-template-rows: repeat(15, 1fr); width: 100%; height: 100%; gap: 1px; background: #ccc; }
        .cell { background: white; position: relative; display: flex; align-items: center; justify-content: center;}
        
        /* Homes */
        .home-red { grid-column: 1 / 7; grid-row: 10 / 16; background: #ef4444; border: 2px solid #b91c1c; display:flex; align-items:center; justify-content:center;}
        .home-blue { grid-column: 10 / 16; grid-row: 1 / 7; background: #3b82f6; border: 2px solid #1d4ed8; display:flex; align-items:center; justify-content:center;}
        .home-inner { width: 70%; height: 70%; background: white; border-radius: 8px; display: grid; grid-template-columns: 1fr 1fr; gap: 5px; padding: 5px; }
        .base-spot { width: 100%; height: 100%; border-radius: 50%; border: 1px solid #ccc; display: flex; align-items: center; justify-content: center;}
        
        /* Safe zones & paths */
        .safe { background: #d1d5db; font-size: 10px; color: #6b7280;}
        .safe::after { content: 'â˜…'; }
        .path-red { background: #fca5a5; }
        .path-blue { background: #93c5fd; }
        .center-home { grid-column: 7 / 10; grid-row: 7 / 10; background: conic-gradient( #3b82f6 0deg 90deg, #10b981 90deg 180deg, #ef4444 180deg 270deg, #f59e0b 270deg 360deg ); border: 1px solid #9ca3af; }

        /* Tokens */
        .goti { width: 16px; height: 16px; border-radius: 50%; position: absolute; border: 2px solid white; box-shadow: 0 3px 5px rgba(0,0,0,0.5); z-index: 10; transition: all 0.3s ease; cursor: pointer; transform: translate(-50%, -50%);}
        .goti.red { background: radial-gradient(circle at 30% 30%, #fca5a5, #dc2626); }
        .goti.blue { background: radial-gradient(circle at 30% 30%, #93c5fd, #2563eb); }
        .goti.active-anim { animation: bounce 0.5s infinite alternate; box-shadow: 0 0 10px yellow; }
        @keyframes bounce { from { transform: translate(-50%, -50%) scale(1); } to { transform: translate(-50%, -60%) scale(1.2); } }

        /* Dice */
        .dice-area { display: flex; gap: 20px; margin-top: 15px; align-items: center; }
        .player-card { padding: 10px 20px; border-radius: 10px; text-align: center; font-weight: bold; opacity: 0.5; transition: 0.3s; border: 2px solid transparent;}
        .player-card.active { opacity: 1; border-color: white; transform: scale(1.05); }
        .player-red { background: #ef4444; } .player-blue { background: #3b82f6; }
        .dice { width: 40px; height: 40px; background: white; color: black; font-size: 24px; display: flex; align-items: center; justify-content: center; border-radius: 8px; cursor: pointer; font-weight:bold; box-shadow: 0 4px 0 #ccc;}
        .dice:active { transform: translateY(4px); box-shadow: none; }
        .rolling { animation: shake 0.4s infinite; }
        @keyframes shake { 0% {transform: rotate(10deg);} 50% {transform: rotate(-10deg);} 100% {transform: rotate(10deg);} }
    </style>
</head>
<body>

    <a href="/tools" class="fixed top-2 left-2 z-50 bg-gray-800/80 hover:bg-gray-700 text-white p-2 rounded-full border border-gray-600 shadow-lg transition">
        <i class="fas fa-arrow-left"></i>
    </a>

    <div class="text-center mb-2 mt-4">
        <h1 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-red-400 to-blue-400">
            Shantanu vs Shanvika ðŸ¤–
        </h1>
        <p class="text-xs text-gray-400" id="status-text">Your Turn (Red). Tap Dice to Roll!</p>
    </div>

    <div class="board-container" id="board">
        </div>

    <div class="dice-area">
        <div class="player-card player-red active" id="turn-red">You<br>ðŸ”´</div>
        <div class="dice" id="dice" onclick="rollDice()">ðŸŽ²</div>
        <div class="player-card player-blue" id="turn-blue">Shanvika<br>ðŸ”µ</div>
    </div>

    <script>
        // Track Path Coordinates (0-51 perimeter) mapping to CSS Grid 1-15 (col, row)
        // Red starts at index 0. Blue starts at index 26.
        const pathCoords = [
            [7,14],[7,13],[7,12],[7,11],[7,10], // 0-4
            [6,9],[5,9],[4,9],[3,9],[2,9],[1,9], // 5-10
            [1,8],[1,7], // 11-12
            [2,7],[3,7],[4,7],[5,7],[6,7], // 13-17
            [7,6],[7,5],[7,4],[7,3],[7,2],[7,1], // 18-23
            [8,1],[9,1], // 24-25
            [9,2],[9,3],[9,4],[9,5],[9,6], // 26-30 (Blue Start)
            [10,7],[11,7],[12,7],[13,7],[14,7],[15,7], // 31-36
            [15,8],[15,9], // 37-38
            [14,9],[13,9],[12,9],[11,9],[10,9], // 39-43
            [9,10],[9,11],[9,12],[9,13],[9,14],[9,15], // 44-49
            [8,15] // 50-51
        ];

        const redHomePath = [[8,14],[8,13],[8,12],[8,11],[8,10],[8,9]]; // Win zone
        const blueHomePath = [[8,2],[8,3],[8,4],[8,5],[8,6],[8,7]]; // Win zone

        const board = document.getElementById('board');
        let gridHTML = '<div class="ludo-grid">';
        for(let r=1; r<=15; r++){
            for(let c=1; c<=15; c++){
                gridHTML += `<div class="cell" id="c-${c}-${r}"></div>`;
            }
        }
        gridHTML += `
            <div class="home-red"><div class="home-inner" id="base-red"></div></div>
            <div class="home-blue"><div class="home-inner" id="base-blue"></div></div>
            <div class="center-home"></div>
        </div>`;
        board.innerHTML = gridHTML;

        // Color Safe Zones & Start Points
        document.getElementById('c-7-14').classList.add('safe', 'path-red');
        document.getElementById('c-9-2').classList.add('safe', 'path-blue');
        // Color Home stretches
        redHomePath.slice(0,-1).forEach(p => document.getElementById(`c-${p[0]}-${p[1]}`).classList.add('path-red'));
        blueHomePath.slice(0,-1).forEach(p => document.getElementById(`c-${p[0]}-${p[1]}`).classList.add('path-blue'));

        // Game State
        let turn = 'red'; // 'red' or 'blue'
        let diceValue = 0;
        let isRolling = false;
        let expectingMove = false;

        const tokens = {
            red: [ {id:'r1', pos:-1}, {id:'r2', pos:-1} ], // Simplified to 2 tokens for speed
            blue: [ {id:'b1', pos:-1}, {id:'b2', pos:-1} ]
        };

        // Initialize Tokens in Bases
        ['red', 'blue'].forEach(color => {
            const base = document.getElementById(`base-${color}`);
            tokens[color].forEach(t => {
                base.innerHTML += `<div class="base-spot" id="spot-${t.id}"></div>`;
                const goti = document.createElement('div');
                goti.className = `goti ${color}`;
                goti.id = t.id;
                goti.onclick = () => moveToken(t.id);
                board.appendChild(goti);
            });
        });

        function updateBoard() {
            // Position all tokens based on their state
            ['red', 'blue'].forEach(color => {
                tokens[color].forEach(t => {
                    const el = document.getElementById(t.id);
                    el.classList.remove('active-anim');
                    if(t.pos === -1) {
                        // In base
                        const spot = document.getElementById(`spot-${t.id}`).getBoundingClientRect();
                        const bRect = board.getBoundingClientRect();
                        el.style.left = (spot.left - bRect.left + spot.width/2) + 'px';
                        el.style.top = (spot.top - bRect.top + spot.height/2) + 'px';
                    } else if (t.pos >= 100) {
                        // In home stretch
                        let path = color === 'red' ? redHomePath : blueHomePath;
                        let idx = t.pos - 100;
                        let cell = document.getElementById(`c-${path[idx][0]}-${path[idx][1]}`);
                        let cRect = cell.getBoundingClientRect();
                        let bRect = board.getBoundingClientRect();
                        el.style.left = (cRect.left - bRect.left + cRect.width/2) + 'px';
                        el.style.top = (cRect.top - bRect.top + cRect.height/2) + 'px';
                        if(idx === 5) el.style.display = 'none'; // Won
                    } else {
                        // On main track
                        let cell = document.getElementById(`c-${pathCoords[t.pos][0]}-${pathCoords[t.pos][1]}`);
                        let cRect = cell.getBoundingClientRect();
                        let bRect = board.getBoundingClientRect();
                        el.style.left = (cRect.left - bRect.left + cRect.width/2) + 'px';
                        el.style.top = (cRect.top - bRect.top + cRect.height/2) + 'px';
                    }
                });
            });

            // Highlight movable tokens if it's user turn
            if(turn === 'red' && expectingMove) {
                tokens.red.forEach(t => {
                    if (canMove(t, diceValue)) document.getElementById(t.id).classList.add('active-anim');
                });
            }
        }
        
        setTimeout(updateBoard, 100); // Initial placement

        function rollDice() {
            if(turn !== 'red' || isRolling || expectingMove) return;
            executeRoll();
        }

        function executeRoll() {
            isRolling = true;
            document.getElementById('status-text').innerText = turn === 'red' ? "Rolling..." : "Shanvika is thinking...";
            const dice = document.getElementById('dice');
            dice.classList.add('rolling');
            
            setTimeout(() => {
                dice.classList.remove('rolling');
                diceValue = Math.floor(Math.random() * 6) + 1;
                dice.innerText = diceValue;
                isRolling = false;
                
                checkMoves();
            }, 600);
        }

        function checkMoves() {
            let movable = tokens[turn].filter(t => canMove(t, diceValue));
            if(movable.length === 0) {
                document.getElementById('status-text').innerText = `No moves! Switching turn.`;
                setTimeout(switchTurn, 1000);
            } else if(movable.length === 1 && turn === 'blue') {
                // AI Auto move if only 1 choice
                setTimeout(() => moveToken(movable[0].id), 800);
            } else if(turn === 'blue') {
                // AI Logic: Prioritize opening, then killing, then winning
                setTimeout(() => {
                    let chosen = movable[0];
                    // Very basic AI: Open if 6, else move first available
                    for(let m of movable) {
                        if(m.pos === -1 && diceValue === 6) chosen = m;
                    }
                    moveToken(chosen.id);
                }, 1000);
            } else {
                expectingMove = true;
                document.getElementById('status-text').innerText = `Tap your bouncing token!`;
                updateBoard();
            }
        }

        function canMove(t, steps) {
            if(t.pos === -1) return steps === 6;
            if(t.pos >= 100 && t.pos - 100 + steps > 5) return false;
            return true;
        }

        function moveToken(id) {
            let tColor = id.startsWith('r') ? 'red' : 'blue';
            if(tColor !== turn || !expectingMove && turn === 'red') return;
            
            let t = tokens[turn].find(x => x.id === id);
            if(!canMove(t, diceValue)) return;

            expectingMove = false;
            
            if(t.pos === -1) {
                t.pos = turn === 'red' ? 0 : 26;
            } else {
                // Advance logic
                for(let i=0; i<diceValue; i++) {
                    if(t.pos >= 100) { t.pos++; }
                    else {
                        t.pos++;
                        if(t.pos > 51) t.pos = 0; // Wrap around
                        
                        // Check if entering home stretch
                        if(turn === 'red' && t.pos === 51) { t.pos = 100; i++; break; } // Red enters at 51
                        if(turn === 'blue' && t.pos === 25) { t.pos = 100; i++; break; } // Blue enters at 25
                    }
                }
            }

            // Kill logic (Simplified, no safe zones check for now to keep it brief)
            let enemyColor = turn === 'red' ? 'blue' : 'red';
            let killed = false;
            if(t.pos >= 0 && t.pos < 100) { // Not home stretch
                // Prevent killing on start spots
                let isSafe = (turn === 'red' && t.pos === 0) || (turn === 'blue' && t.pos === 26) || (t.pos === 13) || (t.pos === 39);
                if(!isSafe) {
                    tokens[enemyColor].forEach(e => {
                        if(e.pos === t.pos) { e.pos = -1; killed = true; } // Kill!
                    });
                }
            }

            updateBoard();

            // Check Win
            if(tokens[turn].every(x => x.pos >= 105)) {
                document.getElementById('status-text').innerText = turn === 'red' ? "YOU WIN! ðŸŽ‰" : "SHANVIKA WINS! ðŸ˜ˆ";
                return;
            }

            if(diceValue === 6 || killed) {
                document.getElementById('status-text').innerText = `Got a ${killed? 'Kill' : '6'}! Roll again.`;
                if(turn === 'blue') setTimeout(executeRoll, 1000);
            } else {
                switchTurn();
            }
        }

        function switchTurn() {
            turn = turn === 'red' ? 'blue' : 'red';
            document.getElementById('turn-red').classList.toggle('active');
            document.getElementById('turn-blue').classList.toggle('active');
            document.getElementById('dice').innerText = "ðŸŽ²";
            document.getElementById('status-text').innerText = turn === 'red' ? "Your Turn (Red). Roll!" : "Shanvika is thinking...";
            
            if(turn === 'blue') {
                setTimeout(executeRoll, 1000);
            }
        }
    </script>
</body>
</html>