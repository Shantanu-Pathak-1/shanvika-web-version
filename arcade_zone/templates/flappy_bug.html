<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flappy Bug â€¢ Arcade</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #050505; color: white; font-family: 'Courier New', Courier, monospace; overflow: hidden; }
        canvas { background: #111827; border: 2px solid #3b82f6; border-radius: 12px; box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); display: block; margin: 0 auto; }
        .glass { background: rgba(30, 41, 59, 0.8); backdrop-filter: blur(10px); }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <a href="/tools" class="fixed top-4 left-4 z-50 bg-gray-800/80 hover:bg-gray-700 text-white p-2 md:px-4 md:py-2 rounded-full border border-gray-600 shadow-lg backdrop-blur-sm transition flex items-center gap-2">
        <i class="fas fa-arrow-left"></i> <span class="hidden md:inline font-bold text-sm">Tools Lab</span>
    </a>

    <div class="text-center mb-4 mt-8">
        <h1 class="text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-400">
            <i class="fas fa-bug text-blue-500 mr-2"></i>Flappy Bug
        </h1>
        <p class="text-gray-400 text-sm mt-1">Dodge the 404 Errors! (Press Space or Tap)</p>
    </div>

    <div class="relative">
        <div id="overlay" class="absolute inset-0 flex flex-col items-center justify-center glass z-10 rounded-xl">
            <h2 id="overlay-title" class="text-3xl font-bold text-white mb-2">Ready to Code?</h2>
            <p id="overlay-score" class="text-lg text-blue-400 font-bold mb-1 hidden">Score: <span id="final-score">0</span></p>
            <p id="overlay-highscore" class="text-sm text-yellow-400 font-bold mb-4">High Score: <span id="high-score-display">0</span></p>
            <button onclick="startGame()" class="px-6 py-2 bg-blue-600 hover:bg-blue-500 rounded-full font-bold text-white transition shadow-[0_0_15px_rgba(37,99,235,0.5)]">
                Start Game
            </button>
        </div>
        <canvas id="gameCanvas" width="320" height="480"></canvas>
    </div>

    <div class="mt-6 flex gap-4 text-xl font-bold">
        <div class="bg-gray-800 px-4 py-2 rounded-lg border border-gray-700">Score: <span id="score" class="text-blue-400">0</span></div>
        <div class="bg-gray-800 px-4 py-2 rounded-lg border border-gray-700">Best: <span id="best-score" class="text-yellow-400">0</span></div>
    </div>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const scoreElement = document.getElementById("score");
        const bestScoreElement = document.getElementById("best-score");
        const overlay = document.getElementById("overlay");
        
        let frames = 0; let score = 0; let gameActive = false; let animationId;
        
        // High Score Logic
        let highScore = localStorage.getItem("flappyBugHighScore") || 0;
        bestScoreElement.innerText = highScore;
        document.getElementById("high-score-display").innerText = highScore;

        const bug = {
            x: 50, y: 150, width: 30, height: 30,
            gravity: 0.12, jump: -4.0, speed: 0, // <--- PHYSICS FIXED HERE
            draw: function() { ctx.font = "30px Arial"; ctx.fillText("ðŸ›", this.x, this.y + 25); },
            update: function() {
                this.speed += this.gravity; this.y += this.speed;
                if (this.y + this.height >= canvas.height || this.y <= 0) gameOver();
            },
            flap: function() { this.speed = this.jump; }
        };

        const pipes = {
            position: [], width: 50, gap: 140, dx: 1.8, // <--- GAP WIDER, SPEED SLOWER
            draw: function() {
                for (let i = 0; i < this.position.length; i++) {
                    let p = this.position[i];
                    let topY = p.y; let bottomY = p.y + this.gap;
                    let grad = ctx.createLinearGradient(p.x, 0, p.x + this.width, 0);
                    grad.addColorStop(0, "#ef4444"); grad.addColorStop(1, "#991b1b");
                    ctx.fillStyle = grad;
                    ctx.fillRect(p.x, 0, this.width, topY);
                    ctx.fillRect(p.x, bottomY, this.width, canvas.height - bottomY);
                    ctx.fillStyle = "white"; ctx.font = "12px Courier";
                    ctx.fillText("404", p.x + 10, topY - 20); ctx.fillText("ERR", p.x + 10, bottomY + 30);
                }
            },
            update: function() {
                if (frames % 100 === 0) this.position.push({ x: canvas.width, y: Math.floor(Math.random() * (canvas.height - this.gap - 100)) + 50 });
                for (let i = 0; i < this.position.length; i++) {
                    let p = this.position[i]; p.x -= this.dx;
                    if (bug.x + bug.width > p.x && bug.x < p.x + this.width && (bug.y < p.y || bug.y + bug.height > p.y + this.gap)) gameOver();
                    if (p.x + this.width === bug.x) { score++; scoreElement.innerText = score; }
                    if (p.x + this.width <= 0) this.position.shift();
                }
            },
            reset: function() { this.position = []; }
        };

        function draw() {
            ctx.fillStyle = "#111827"; ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = "rgba(59, 130, 246, 0.1)"; ctx.lineWidth = 1;
            for(let i=0; i<canvas.width; i+=40) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,canvas.height); ctx.stroke(); }
            for(let i=0; i<canvas.height; i+=40) { ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(canvas.width,i); ctx.stroke(); }
            pipes.draw(); bug.draw();
        }

        function update() { bug.update(); pipes.update(); }

        function loop() {
            if (!gameActive) return;
            update(); draw(); frames++;
            animationId = requestAnimationFrame(loop);
        }

        function startGame() {
            bug.y = 150; bug.speed = 0; pipes.reset();
            score = 0; scoreElement.innerText = score; frames = 0;
            gameActive = true; overlay.classList.add("hidden");
            cancelAnimationFrame(animationId); loop();
        }

        function gameOver() {
            gameActive = false;
            if(score > highScore) { 
                highScore = score; localStorage.setItem("flappyBugHighScore", highScore);
                bestScoreElement.innerText = highScore; document.getElementById("high-score-display").innerText = highScore;
            }
            overlay.classList.remove("hidden");
            document.getElementById("overlay-title").innerText = "System Crashed! ðŸ’¥";
            document.getElementById("overlay-score").classList.remove("hidden");
            document.getElementById("final-score").innerText = score;
        }

        window.addEventListener("keydown", (e) => { if (e.code === "Space" && gameActive) bug.flap(); });
        canvas.addEventListener("mousedown", () => { if (gameActive) bug.flap(); });
        canvas.addEventListener("touchstart", (e) => { e.preventDefault(); if (gameActive) bug.flap(); }, {passive: false});
    </script>
</body>
</html>